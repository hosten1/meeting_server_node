<!-- public/index.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>房间管理系统后台</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --sidebar-width: 250px;
            --header-height: 60px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* 侧边栏样式 */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--secondary-color);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 20px;
            background-color: var(--dark-color);
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h2 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: block;
            padding: 12px 20px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: var(--primary-color);
        }

        .sidebar-menu i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* 主内容区 */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 20px;
            transition: margin-left 0.3s ease;
        }

        /* 顶部导航 */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .header h1 {
            font-size: 1.8rem;
            color: var(--secondary-color);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .refresh-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.5rem;
        }

        .rooms-icon { background-color: rgba(52, 152, 219, 0.2); color: var(--primary-color); }
        .users-icon { background-color: rgba(46, 204, 113, 0.2); color: var(--success-color); }
        .online-icon { background-color: rgba(155, 89, 182, 0.2); color: #9b59b6; }
        .active-icon { background-color: rgba(241, 196, 15, 0.2); color: var(--warning-color); }

        .stat-info h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .stat-info p {
            color: #666;
            font-size: 0.9rem;
        }

        /* 房间列表表格 */
        .section-title {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: var(--secondary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title i {
            margin-right: 10px;
        }

        .table-container {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background-color: var(--secondary-color);
            color: white;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        tbody tr:hover {
            background-color: #f9f9f9;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-active {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success-color);
        }

        .status-inactive {
            background-color: rgba(149, 165, 166, 0.2);
            color: #7f8c8d;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .btn-view { background-color: #3498db; color: white; }
        .btn-edit { background-color: #f39c12; color: white; }
        .btn-delete { background-color: #e74c3c; color: white; }
        .btn-kick { background-color: #95a5a6; color: white; }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* 模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding: 20px;
            background-color: var(--secondary-color);
            color: white;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.3rem;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .modal-footer {
            padding: 15px 20px;
            background-color: #f9f9f9;
            border-radius: 0 0 10px 10px;
            text-align: right;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
        }

        .btn-secondary {
            background-color: #95a5a6;
            color: white;
            padding: 10px 20px;
            margin-right: 10px;
        }

        /* 用户列表 */
        .user-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .user-card {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .user-info h4 {
            margin-bottom: 5px;
        }

        .user-info p {
            font-size: 0.8rem;
            color: #777;
        }

        .online-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: auto;
        }

        .online {
            background-color: var(--success-color);
        }

        .offline {
            background-color: #ccc;
        }

        /* 响应式设计 */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            table {
                display: block;
                overflow-x: auto;
            }
        }

        @media (max-width: 576px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
        }

        /* 加载动画 */
        .loading {
            text-align: center;
            padding: 40px;
            color: #777;
        }

        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 工具类 */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mb-20 { margin-bottom: 20px; }
        .mt-20 { margin-top: 20px; }
        .d-none { display: none; }
        .d-flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .align-center { align-items: center; }
        .gap-10 { gap: 10px; }

        /* 菜单切换按钮 */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--secondary-color);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
        }

        @media (max-width: 992px) {
            .menu-toggle {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 侧边栏 -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-video"></i> 房间管理</h2>
                <p>后台管理系统 v1.0</p>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" class="active" id="dashboard-link"><i class="fas fa-home"></i> 仪表盘</a></li>
                <li><a href="#" id="rooms-link"><i class="fas fa-door-open"></i> 房间管理</a></li>
                <li><a href="#" id="users-link"><i class="fas fa-users"></i> 用户管理</a></li>
                <li><a href="#" id="config-link"><i class="fas fa-cog"></i> 系统配置</a></li>
                <li><a href="#" id="logs-link"><i class="fas fa-clipboard-list"></i> 操作日志</a></li>
                <li><a href="#" id="help-link"><i class="fas fa-question-circle"></i> 帮助</a></li>
            </ul>
        </aside>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 顶部导航 -->
            <div class="header">
                <div class="d-flex align-center gap-10">
                    <button class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 id="page-title">仪表盘</h1>
                </div>
                <div class="header-actions">
                    <button class="refresh-btn" id="refreshData">
                        <i class="fas fa-sync-alt"></i> 刷新数据
                    </button>
                    <div class="server-status">
                        <span class="status-badge status-active" id="serverStatus">服务器运行中</span>
                    </div>
                </div>
            </div>

            <!-- 仪表盘内容 -->
            <div id="dashboard-content" class="page-content">
                <!-- 统计卡片 -->
                <div class="stats-container" id="statsContainer">
                    <!-- 动态加载统计数据 -->
                </div>

                <!-- 房间列表 -->
                <div class="section-title">
                    <span><i class="fas fa-door-open"></i> 最近活跃的房间</span>
                    <button class="btn btn-primary" id="viewAllRooms">查看所有房间</button>
                </div>
                <div class="table-container">
                    <table id="roomsTable">
                        <thead>
                            <tr>
                                <th>房间ID</th>
                                <th>房间名称</th>
                                <th>创建者</th>
                                <th>用户数</th>
                                <th>状态</th>
                                <th>创建时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="roomsTableBody">
                            <!-- 动态加载房间数据 -->
                        </tbody>
                    </table>
                </div>

                <!-- 系统信息 -->
                <div class="section-title">
                    <span><i class="fas fa-info-circle"></i> 系统信息</span>
                </div>
                <div class="table-container">
                    <table>
                        <tbody id="systemInfo">
                            <!-- 动态加载系统信息 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 房间管理页面 -->
            <div id="rooms-content" class="page-content d-none">
                <div class="section-title justify-between">
                    <span><i class="fas fa-door-open"></i> 房间列表</span>
                    <button class="btn btn-primary" id="createRoomBtn">
                        <i class="fas fa-plus"></i> 创建房间
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>房间ID</th>
                                <th>房间名称</th>
                                <th>创建者</th>
                                <th>用户数</th>
                                <th>状态</th>
                                <th>创建时间</th>
                                <th>最后活动</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="allRoomsTableBody">
                            <!-- 动态加载所有房间数据 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 用户管理页面 -->
            <div id="users-content" class="page-content d-none">
                <div class="section-title">
                    <span><i class="fas fa-users"></i> 在线用户</span>
                </div>
                <div id="onlineUsersList" class="user-list">
                    <!-- 动态加载在线用户 -->
                </div>

                <div class="section-title mt-20">
                    <span><i class="fas fa-user-clock"></i> 离线用户 (最近24小时)</span>
                </div>
                <div id="offlineUsersList" class="user-list">
                    <!-- 动态加载离线用户 -->
                </div>
            </div>

            <!-- 系统配置页面 -->
            <div id="config-content" class="page-content d-none">
                <div class="section-title">
                    <span><i class="fas fa-cog"></i> 系统配置</span>
                </div>
                <div class="table-container">
                    <form id="systemConfigForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>服务器主机</label>
                                <input type="text" class="form-control" id="serverHost" value="8.137.17.218" readonly>
                            </div>
                            <div class="form-group">
                                <label>服务器端口</label>
                                <input type="number" class="form-control" id="serverPort" value="6000">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>房间最大用户数</label>
                                <input type="number" class="form-control" id="maxUsersPerRoom" value="50">
                            </div>
                            <div class="form-group">
                                <label>用户离线超时(分钟)</label>
                                <input type="number" class="form-control" id="userOfflineTimeout" value="30">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>房间空闲超时(分钟)</label>
                                <input type="number" class="form-control" id="roomIdleTimeout" value="60">
                            </div>
                            <div class="form-group">
                                <label>清理任务间隔(分钟)</label>
                                <input type="number" class="form-control" id="cleanupInterval" value="10">
                            </div>
                        </div>
                        <div class="form-footer text-right">
                            <button type="button" class="btn btn-secondary" id="resetConfig">恢复默认</button>
                            <button type="submit" class="btn btn-primary">保存配置</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 操作日志页面 -->
            <div id="logs-content" class="page-content d-none">
                <div class="section-title justify-between">
                    <span><i class="fas fa-clipboard-list"></i> 操作日志</span>
                    <button class="btn btn-primary" id="clearLogsBtn">清空日志</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>时间</th>
                                <th>级别</th>
                                <th>模块</th>
                                <th>操作</th>
                                <th>详情</th>
                            </tr>
                        </thead>
                        <tbody id="logsTableBody">
                            <!-- 动态加载日志 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 帮助页面 -->
            <div id="help-content" class="page-content d-none">
                <div class="section-title">
                    <span><i class="fas fa-question-circle"></i> 帮助文档</span>
                </div>
                <div class="table-container">
                    <div class="modal-body">
                        <h3>房间管理系统使用指南</h3>
                        <p>这是一个房间管理后台，用于管理实时音视频房间。</p>
                        
                        <h4>主要功能：</h4>
                        <ul>
                            <li><strong>仪表盘</strong>：查看系统概览和统计数据</li>
                            <li><strong>房间管理</strong>：查看、创建、编辑、删除房间</li>
                            <li><strong>用户管理</strong>：查看在线/离线用户，管理用户状态</li>
                            <li><strong>系统配置</strong>：调整系统参数</li>
                            <li><strong>操作日志</strong>：查看系统操作记录</li>
                        </ul>
                        
                        <h4>API接口：</h4>
                        <p>系统提供以下API接口：</p>
                        <ul>
                            <li><code>GET /api/room</code> - 获取所有房间列表</li>
                            <li><code>POST /api/room/create</code> - 创建房间</li>
                            <li><code>POST /api/room/join</code> - 加入房间</li>
                            <li><code>GET /api/room/:roomId</code> - 获取房间信息</li>
                            <li><code>DELETE /api/room/:roomId</code> - 解散房间</li>
                            <li><code>GET /api/health</code> - 健康检查</li>
                        </ul>
                        
                        <h4>常见问题：</h4>
                        <p><strong>Q: 如何创建房间？</strong><br>
                        A: 在房间管理页面点击"创建房间"按钮，填写房间信息。</p>
                        
                        <p><strong>Q: 如何解散房间？</strong><br>
                        A: 在房间列表中找到对应房间，点击"删除"按钮。</p>
                        
                        <p><strong>Q: 如何查看房间中的用户？</strong><br>
                        A: 在房间列表中点击"查看"按钮，可以查看房间详情和用户列表。</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 房间详情模态框 -->
    <div id="roomDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="roomDetailTitle">房间详情</h3>
                <button class="close-modal" id="closeRoomDetail">&times;</button>
            </div>
            <div class="modal-body">
                <div id="roomDetailContent">
                    <!-- 动态加载房间详情 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 创建/编辑房间模态框 -->
    <div id="roomEditModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="roomEditTitle">创建房间</h3>
                <button class="close-modal" id="closeRoomEdit">&times;</button>
            </div>
            <form id="roomEditForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label>房间ID</label>
                        <input type="text" class="form-control" id="editRoomId" required>
                        <small class="form-text">房间唯一标识，只能包含字母、数字和短横线</small>
                    </div>
                    <div class="form-group">
                        <label>房间名称</label>
                        <input type="text" class="form-control" id="editRoomName" required>
                    </div>
                    <div class="form-group">
                        <label>创建者用户ID</label>
                        <input type="text" class="form-control" id="editCreatorId" required>
                    </div>
                    <div class="form-group">
                        <label>创建者昵称</label>
                        <input type="text" class="form-control" id="editCreatorNickname">
                    </div>
                    
                    <h4>媒体服务配置</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>媒体服务器地址</label>
                            <input type="text" class="form-control" id="editMediaHost" value="localhost" required>
                        </div>
                        <div class="form-group">
                            <label>媒体服务器端口</label>
                            <input type="number" class="form-control" id="editMediaPort" value="6000" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>协议</label>
                            <select class="form-control" id="editMediaProtocol">
                                <option value="https">HTTPS</option>
                                <option value="http">HTTP</option>
                                <option value="ws">WebSocket</option>
                                <option value="wss">WebSocket Secure</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>最大用户数</label>
                            <input type="number" class="form-control" id="editMaxUsers" value="50" min="1" max="1000">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancelRoomEdit">取消</button>
                    <button type="submit" class="btn btn-primary" id="saveRoomBtn">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 确认对话框 -->
    <div id="confirmModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 id="confirmTitle">确认操作</h3>
                <button class="close-modal" id="closeConfirmModal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">确定要执行此操作吗？</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelConfirm">取消</button>
                <button type="button" class="btn btn-primary" id="confirmAction">确定</button>
            </div>
        </div>
    </div>

    <script>
        // API 基础URL
        const API_BASE_URL = '/api';
        
        // 当前选中的房间ID
        let currentRoomId = null;
        
        // 当前操作类型
        let currentAction = null;
        
        // 存储房间数据
        let roomsData = [];
        
        // 存储用户数据
        let usersData = [];

        // DOM元素
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.querySelector('.sidebar');
        const pageContents = document.querySelectorAll('.page-content');
        const pageTitle = document.getElementById('page-title');
        const refreshBtn = document.getElementById('refreshData');
        const serverStatus = document.getElementById('serverStatus');
        
        // 导航链接
        const navLinks = document.querySelectorAll('.sidebar-menu a');
        
        // 模态框
        const roomDetailModal = document.getElementById('roomDetailModal');
        const roomEditModal = document.getElementById('roomEditModal');
        const confirmModal = document.getElementById('confirmModal');
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initEventListeners();
            loadDashboard();
            checkServerStatus();
            
            // 每30秒自动刷新数据
            setInterval(loadDashboard, 30000);
        });

        // 初始化事件监听器
        function initEventListeners() {
            // 菜单切换
            menuToggle.addEventListener('click', function() {
                sidebar.classList.toggle('active');
            });

            // 导航菜单点击
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // 更新活动菜单项
                    navLinks.forEach(item => item.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 显示对应页面
                    const pageId = this.id.replace('-link', '-content');
                    showPage(pageId);
                    
                    // 更新页面标题
                    const pageTitles = {
                        'dashboard-content': '仪表盘',
                        'rooms-content': '房间管理',
                        'users-content': '用户管理',
                        'config-content': '系统配置',
                        'logs-content': '操作日志',
                        'help-content': '帮助'
                    };
                    pageTitle.textContent = pageTitles[pageId] || '仪表盘';
                    
                    // 如果是小屏幕，点击后关闭侧边栏
                    if (window.innerWidth <= 992) {
                        sidebar.classList.remove('active');
                    }
                });
            });

            // 刷新按钮
            refreshBtn.addEventListener('click', function() {
                loadDashboard();
                showToast('数据已刷新', 'success');
            });

            // 查看所有房间按钮
            document.getElementById('viewAllRooms')?.addEventListener('click', function() {
                document.getElementById('rooms-link').click();
                loadAllRooms();
            });

            // 创建房间按钮
            document.getElementById('createRoomBtn')?.addEventListener('click', function() {
                openRoomEditModal();
            });

            // 模态框关闭按钮
            document.getElementById('closeRoomDetail')?.addEventListener('click', function() {
                roomDetailModal.style.display = 'none';
            });

            document.getElementById('closeRoomEdit')?.addEventListener('click', function() {
                roomEditModal.style.display = 'none';
            });

            document.getElementById('closeConfirmModal')?.addEventListener('click', function() {
                confirmModal.style.display = 'none';
            });

            document.getElementById('cancelRoomEdit')?.addEventListener('click', function() {
                roomEditModal.style.display = 'none';
            });

            document.getElementById('cancelConfirm')?.addEventListener('click', function() {
                confirmModal.style.display = 'none';
            });

            // 点击模态框外部关闭
            window.addEventListener('click', function(e) {
                if (e.target === roomDetailModal) {
                    roomDetailModal.style.display = 'none';
                }
                if (e.target === roomEditModal) {
                    roomEditModal.style.display = 'none';
                }
                if (e.target === confirmModal) {
                    confirmModal.style.display = 'none';
                }
            });

            // 房间编辑表单提交
            document.getElementById('roomEditForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                saveRoom();
            });

            // 系统配置表单提交
            document.getElementById('systemConfigForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                saveSystemConfig();
            });

            // 重置配置按钮
            document.getElementById('resetConfig')?.addEventListener('click', function() {
                document.getElementById('serverPort').value = 6000;
                document.getElementById('maxUsersPerRoom').value = 50;
                document.getElementById('userOfflineTimeout').value = 30;
                document.getElementById('roomIdleTimeout').value = 60;
                document.getElementById('cleanupInterval').value = 10;
                showToast('配置已重置为默认值', 'info');
            });

            // 清空日志按钮
            document.getElementById('clearLogsBtn')?.addEventListener('click', function() {
                showConfirm('确定要清空所有日志吗？', function() {
                    // 这里调用清空日志的API
                    showToast('日志已清空', 'success');
                    loadLogs();
                });
            });
        }

        // 显示页面
        function showPage(pageId) {
            pageContents.forEach(page => {
                page.classList.add('d-none');
            });
            document.getElementById(pageId).classList.remove('d-none');
            
            // 加载对应页面的数据
            switch(pageId) {
                case 'dashboard-content':
                    loadDashboard();
                    break;
                case 'rooms-content':
                    loadAllRooms();
                    break;
                case 'users-content':
                    loadUsers();
                    break;
                case 'logs-content':
                    loadLogs();
                    break;
            }
        }

        // 检查服务器状态
        async function checkServerStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                if (response.ok) {
                    serverStatus.textContent = '服务器运行中';
                    serverStatus.className = 'status-badge status-active';
                } else {
                    serverStatus.textContent = '服务器异常';
                    serverStatus.className = 'status-badge status-inactive';
                }
            } catch (error) {
                serverStatus.textContent = '连接失败';
                serverStatus.className = 'status-badge status-inactive';
            }
        }

        // 加载仪表盘数据
        async function loadDashboard() {
            try {
                // 显示加载状态
                document.getElementById('statsContainer').innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>加载统计数据...</p>
                    </div>
                `;
                
                document.getElementById('roomsTableBody').innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                <p>加载房间数据...</p>
                            </div>
                        </td>
                    </tr>
                `;

                // 获取系统统计
                const statsResponse = await fetch(`${API_BASE_URL}/health`);
                const statsData = await statsResponse.json();
                
                // 获取所有房间
                const roomsResponse = await fetch(`${API_BASE_URL}/room`);
                const roomsData = await roomsResponse.json();

                // 更新统计卡片
                updateStats(statsData.stats);
                
                // 更新房间表格
                updateRoomsTable(roomsData.data.rooms.slice(0, 10)); // 只显示前10个
                
                // 更新系统信息
                updateSystemInfo(statsData);
                
            } catch (error) {
                console.error('加载仪表盘数据失败:', error);
                document.getElementById('statsContainer').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-info">
                            <h3>错误</h3>
                            <p>无法加载统计数据</p>
                        </div>
                    </div>
                `;
                
                document.getElementById('roomsTableBody').innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">加载数据失败，请检查网络连接</td>
                    </tr>
                `;
            }
        }

        // 更新统计卡片
        function updateStats(stats) {
            const statsContainer = document.getElementById('statsContainer');
            
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon rooms-icon">
                        <i class="fas fa-door-open"></i>
                    </div>
                    <div class="stat-info">
                        <h3>${stats.rooms || 0}</h3>
                        <p>总房间数</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon users-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3>${stats.totalUsers || 0}</h3>
                        <p>总用户数</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon online-icon">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="stat-info">
                        <h3>${stats.onlineUsers || 0}</h3>
                        <p>在线用户</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon active-icon">
                        <i class="fas fa-broadcast-tower"></i>
                    </div>
                    <div class="stat-info">
                        <h3>${stats.activeRooms || 0}</h3>
                        <p>活跃房间</p>
                    </div>
                </div>
            `;
        }

        // 更新房间表格
        function updateRoomsTable(rooms) {
            const tbody = document.getElementById('roomsTableBody');
            
            if (!rooms || rooms.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">暂无房间数据</td>
                    </tr>
                `;
                return;
            }
            
            let rows = '';
            rooms.forEach(room => {
                const createTime = new Date(room.createdAt).toLocaleString();
                const statusClass = room.isActive ? 'status-active' : 'status-inactive';
                const statusText = room.isActive ? '活跃' : '闲置';
                
                rows += `
                    <tr>
                        <td><strong>${room.roomId}</strong></td>
                        <td>${room.roomName}</td>
                        <td>${room.creator}</td>
                        <td>${room.userCount}/${room.maxUsers}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>${createTime}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-view" onclick="viewRoomDetail('${room.roomId}')">
                                    <i class="fas fa-eye"></i> 查看
                                </button>
                                <button class="btn btn-delete" onclick="deleteRoom('${room.roomId}', '${room.roomName}')">
                                    <i class="fas fa-trash"></i> 删除
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = rows;
        }

        // 更新系统信息
        function updateSystemInfo(healthData) {
            const systemInfo = document.getElementById('systemInfo');
            
            systemInfo.innerHTML = `
                <tr>
                    <td width="30%"><strong>服务器状态</strong></td>
                    <td><span class="status-badge status-active">运行正常</span></td>
                </tr>
                <tr>
                    <td><strong>API版本</strong></td>
                    <td>${healthData.version || '1.1.0'}</td>
                </tr>
                <tr>
                    <td><strong>最后更新</strong></td>
                    <td>${new Date().toLocaleString()}</td>
                </tr>
                <tr>
                    <td><strong>服务器时间</strong></td>
                    <td>${new Date(healthData.timestamp).toLocaleString()}</td>
                </tr>
                <tr>
                    <td><strong>内存使用</strong></td>
                    <td>正常</td>
                </tr>
            `;
        }

        // 加载所有房间
        async function loadAllRooms() {
            try {
                const allRoomsTableBody = document.getElementById('allRoomsTableBody');
                allRoomsTableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                <p>加载房间数据...</p>
                            </div>
                        </td>
                    </tr>
                `;

                const response = await fetch(`${API_BASE_URL}/room`);
                const data = await response.json();
                
                roomsData = data.data.rooms || [];
                
                let rows = '';
                if (roomsData.length === 0) {
                    rows = `<tr><td colspan="8" class="text-center">暂无房间数据</td></tr>`;
                } else {
                    roomsData.forEach(room => {
                        const createTime = new Date(room.createdAt).toLocaleString();
                        const lastActive = new Date(room.lastActive).toLocaleString();
                        const statusClass = room.isActive ? 'status-active' : 'status-inactive';
                        const statusText = room.isActive ? '活跃' : '闲置';
                        
                        rows += `
                            <tr>
                                <td><strong>${room.roomId}</strong></td>
                                <td>${room.roomName}</td>
                                <td>${room.creator}</td>
                                <td>${room.userCount}/${room.maxUsers}</td>
                                <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                                <td>${createTime}</td>
                                <td>${lastActive}</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-view" onclick="viewRoomDetail('${room.roomId}')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-edit" onclick="editRoom('${room.roomId}')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-delete" onclick="deleteRoom('${room.roomId}', '${room.roomName}')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `;
                    });
                }
                
                allRoomsTableBody.innerHTML = rows;
            } catch (error) {
                console.error('加载房间数据失败:', error);
                document.getElementById('allRoomsTableBody').innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center">加载数据失败，请检查网络连接</td>
                    </tr>
                `;
            }
        }

        // 查看房间详情
        async function viewRoomDetail(roomId) {
            currentRoomId = roomId;
            
            try {
                const response = await fetch(`${API_BASE_URL}/room/${roomId}`);
                const data = await response.json();
                
                if (data.success) {
                    const room = data.data;
                    const createTime = new Date(room.createdAt).toLocaleString();
                    const lastActive = new Date(room.lastActive).toLocaleString();
                    
                    // 获取房间用户
                    const usersResponse = await fetch(`${API_BASE_URL}/room/${roomId}/users`);
                    const usersData = await usersResponse.json();
                    
                    let usersHtml = '';
                    if (usersData.success && usersData.data.users) {
                        usersData.data.users.forEach(user => {
                            const joinedTime = new Date(user.joinedAt).toLocaleString();
                            const lastActiveTime = new Date(user.lastActive).toLocaleString();
                            
                            usersHtml += `
                                <div class="user-card">
                                    <div class="user-avatar">${user.nickname.charAt(0).toUpperCase()}</div>
                                    <div class="user-info">
                                        <h4>${user.nickname}</h4>
                                        <p>ID: ${user.userId}</p>
                                        <p>加入时间: ${joinedTime}</p>
                                        <p>最后活动: ${lastActiveTime}</p>
                                    </div>
                                    <div class="online-indicator ${user.isOnline ? 'online' : 'offline'}"></div>
                                    <button class="btn btn-kick" onclick="kickUser('${user.userId}', '${roomId}')">
                                        <i class="fas fa-user-slash"></i>
                                    </button>
                                </div>
                            `;
                        });
                    } else {
                        usersHtml = '<p class="text-center">暂无用户数据</p>';
                    }
                    
                    document.getElementById('roomDetailTitle').textContent = `房间详情 - ${room.roomName}`;
                    
                    document.getElementById('roomDetailContent').innerHTML = `
                        <div class="form-group">
                            <label>房间ID</label>
                            <p><strong>${room.roomId}</strong></p>
                        </div>
                        <div class="form-group">
                            <label>房间名称</label>
                            <p>${room.roomName}</p>
                        </div>
                        <div class="form-group">
                            <label>创建者</label>
                            <p>${room.creator}</p>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>创建时间</label>
                                <p>${createTime}</p>
                            </div>
                            <div class="form-group">
                                <label>最后活动</label>
                                <p>${lastActive}</p>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>用户数</label>
                                <p>${room.userCount} / ${room.maxUsers}</p>
                            </div>
                            <div class="form-group">
                                <label>状态</label>
                                <p><span class="status-badge ${room.isActive ? 'status-active' : 'status-inactive'}">
                                    ${room.isActive ? '活跃' : '闲置'}
                                </span></p>
                            </div>
                        </div>
                        <h4>媒体服务配置</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>服务器地址</label>
                                <p>${room.mediaConfig.host}:${room.mediaConfig.port}</p>
                            </div>
                            <div class="form-group">
                                <label>协议</label>
                                <p>${room.mediaConfig.protocol.toUpperCase()}</p>
                            </div>
                        </div>
                        <h4>房间用户 (${room.userCount}人)</h4>
                        <div class="user-list">
                            ${usersHtml}
                        </div>
                        <div class="form-footer text-right mt-20">
                            <button class="btn btn-secondary" onclick="closeModal('roomDetailModal')">关闭</button>
                            <button class="btn btn-primary" onclick="editRoom('${room.roomId}')">编辑房间</button>
                        </div>
                    `;
                    
                    roomDetailModal.style.display = 'flex';
                } else {
                    showToast('获取房间信息失败', 'error');
                }
            } catch (error) {
                console.error('获取房间详情失败:', error);
                showToast('获取房间信息失败', 'error');
            }
        }

        // 编辑房间
        async function editRoom(roomId) {
            currentRoomId = roomId;
            
            try {
                const response = await fetch(`${API_BASE_URL}/room/${roomId}`);
                const data = await response.json();
                
                if (data.success) {
                    const room = data.data;
                    
                    document.getElementById('roomEditTitle').textContent = '编辑房间';
                    document.getElementById('editRoomId').value = room.roomId;
                    document.getElementById('editRoomId').readOnly = true;
                    document.getElementById('editRoomName').value = room.roomName;
                    document.getElementById('editCreatorId').value = room.creator;
                    document.getElementById('editCreatorId').readOnly = true;
                    document.getElementById('editCreatorNickname').value = room.creator;
                    document.getElementById('editMaxUsers').value = room.maxUsers;
                    
                    // 媒体配置
                    if (room.mediaConfig) {
                        document.getElementById('editMediaHost').value = room.mediaConfig.host;
                        document.getElementById('editMediaPort').value = room.mediaConfig.port;
                        document.getElementById('editMediaProtocol').value = room.mediaConfig.protocol;
                    }
                    
                    roomEditModal.style.display = 'flex';
                    roomDetailModal.style.display = 'none';
                } else {
                    showToast('获取房间信息失败', 'error');
                }
            } catch (error) {
                console.error('获取房间信息失败:', error);
                showToast('获取房间信息失败', 'error');
            }
        }

        // 打开创建房间模态框
        function openRoomEditModal() {
            document.getElementById('roomEditTitle').textContent = '创建房间';
            document.getElementById('editRoomId').value = '';
            document.getElementById('editRoomId').readOnly = false;
            document.getElementById('editRoomName').value = '';
            document.getElementById('editCreatorId').value = '';
            document.getElementById('editCreatorId').readOnly = false;
            document.getElementById('editCreatorNickname').value = '';
            document.getElementById('editMaxUsers').value = 50;
            
            // 重置媒体配置
            document.getElementById('editMediaHost').value = 'localhost';
            document.getElementById('editMediaPort').value = 6000;
            document.getElementById('editMediaProtocol').value = 'https';
            
            roomEditModal.style.display = 'flex';
        }

        // 保存房间
        async function saveRoom() {
            const roomId = document.getElementById('editRoomId').value.trim();
            const roomName = document.getElementById('editRoomName').value.trim();
            const creatorId = document.getElementById('editCreatorId').value.trim();
            const creatorNickname = document.getElementById('editCreatorNickname').value.trim() || creatorId;
            const maxUsers = parseInt(document.getElementById('editMaxUsers').value);
            
            const mediaConfig = {
                host: document.getElementById('editMediaHost').value.trim(),
                port: parseInt(document.getElementById('editMediaPort').value),
                protocol: document.getElementById('editMediaProtocol').value
            };
            
            if (!roomId || !roomName || !creatorId) {
                showToast('请填写完整的房间信息', 'error');
                return;
            }
            
            try {
                // 检查是创建还是更新
                const isEdit = document.getElementById('roomEditTitle').textContent === '编辑房间';
                
                let response;
                if (isEdit) {
                    // 更新房间 - 这里我们假设有更新房间的API
                    // 由于原API没有更新房间信息的接口，这里我们只更新媒体配置
                    const updateData = {
                        mediaConfig: mediaConfig
                    };
                    
                    response = await fetch(`${API_BASE_URL}/room/${roomId}/media-config`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            userId: creatorId,
                            ...updateData
                        })
                    });
                    
                    if (response.ok) {
                        showToast('房间配置已更新', 'success');
                        roomEditModal.style.display = 'none';
                        loadAllRooms();
                        loadDashboard();
                    }
                } else {
                    // 创建房间
                    const roomData = {
                        roomId: roomId,
                        userId: creatorId,
                        nickname: creatorNickname,
                        roomName: roomName,
                        mediaConfig: mediaConfig
                    };
                    
                    response = await fetch(`${API_BASE_URL}/room/create`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(roomData)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        showToast('房间创建成功', 'success');
                        roomEditModal.style.display = 'none';
                        loadAllRooms();
                        loadDashboard();
                    } else {
                        showToast(`创建失败: ${result.message}`, 'error');
                    }
                }
            } catch (error) {
                console.error('保存房间失败:', error);
                showToast('保存房间失败，请检查网络连接', 'error');
            }
        }

        // 删除房间
        function deleteRoom(roomId, roomName) {
            currentRoomId = roomId;
            currentAction = 'deleteRoom';
            
            showConfirm(`确定要删除房间 "${roomName}" (${roomId}) 吗？此操作将解散房间并移除所有用户。`, async function() {
                try {
                    // 注意：原API解散房间需要使用DELETE方法，但需要传递userId
                    // 这里我们假设当前用户是管理员，可以使用一个默认的userId
                    // 实际应用中应该从登录信息获取userId
                    const userId = 'admin'; // 默认管理员ID
                    
                    const response = await fetch(`${API_BASE_URL}/room/disband`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            roomId: roomId,
                            userId: userId
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        showToast('房间删除成功', 'success');
                        loadAllRooms();
                        loadDashboard();
                    } else {
                        showToast(`删除失败: ${result.message}`, 'error');
                    }
                } catch (error) {
                    console.error('删除房间失败:', error);
                    showToast('删除房间失败', 'error');
                }
            });
        }

        // 踢出用户
        function kickUser(userId, roomId) {
            currentRoomId = roomId;
            
            showConfirm(`确定要将用户 ${userId} 踢出房间吗？`, async function() {
                try {
                    // 注意：原API没有踢出用户的接口，这里我们调用离开房间的API
                    const response = await fetch(`${API_BASE_URL}/room/leave`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            roomId: roomId,
                            userId: userId
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        showToast('用户已踢出房间', 'success');
                        // 刷新房间详情
                        viewRoomDetail(roomId);
                    } else {
                        showToast(`操作失败: ${result.message}`, 'error');
                    }
                } catch (error) {
                    console.error('踢出用户失败:', error);
                    showToast('踢出用户失败', 'error');
                }
            });
        }

        // 加载用户数据
        async function loadUsers() {
            try {
                const onlineUsersList = document.getElementById('onlineUsersList');
                const offlineUsersList = document.getElementById('offlineUsersList');
                
                onlineUsersList.innerHTML = '<div class="loading"><div class="loading-spinner"></div><p>加载在线用户...</p></div>';
                offlineUsersList.innerHTML = '<div class="loading"><div class="loading-spinner"></div><p>加载离线用户...</p></div>';
                
                // 获取所有房间
                const roomsResponse = await fetch(`${API_BASE_URL}/room`);
                const roomsData = await roomsResponse.json();
                
                // 收集所有用户
                let allUsers = [];
                const rooms = roomsData.data.rooms || [];
                
                for (const room of rooms) {
                    const usersResponse = await fetch(`${API_BASE_URL}/room/${room.roomId}/users`);
                    const usersData = await usersResponse.json();
                    
                    if (usersData.success && usersData.data.users) {
                        allUsers = allUsers.concat(usersData.data.users);
                    }
                }
                
                // 分离在线和离线用户
                const onlineUsers = allUsers.filter(user => user.isOnline);
                const offlineUsers = allUsers.filter(user => !user.isOnline);
                
                // 显示在线用户
                let onlineHtml = '';
                if (onlineUsers.length === 0) {
                    onlineHtml = '<p class="text-center">暂无在线用户</p>';
                } else {
                    onlineUsers.forEach(user => {
                        const joinedTime = new Date(user.joinedAt).toLocaleString();
                        
                        onlineHtml += `
                            <div class="user-card">
                                <div class="user-avatar" style="background-color: #27ae60;">${user.nickname.charAt(0).toUpperCase()}</div>
                                <div class="user-info">
                                    <h4>${user.nickname}</h4>
                                    <p>ID: ${user.userId}</p>
                                    <p>房间: ${user.roomId}</p>
                                    <p>加入时间: ${joinedTime}</p>
                                </div>
                                <div class="online-indicator online"></div>
                            </div>
                        `;
                    });
                }
                onlineUsersList.innerHTML = onlineHtml;
                
                // 显示离线用户（最近24小时）
                let offlineHtml = '';
                const oneDayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);
                const recentOfflineUsers = offlineUsers.filter(user => new Date(user.lastActive) > oneDayAgo);
                
                if (recentOfflineUsers.length === 0) {
                    offlineHtml = '<p class="text-center">暂无最近离线用户</p>';
                } else {
                    recentOfflineUsers.forEach(user => {
                        const lastActiveTime = new Date(user.lastActive).toLocaleString();
                        
                        offlineHtml += `
                            <div class="user-card">
                                <div class="user-avatar" style="background-color: #7f8c8d;">${user.nickname.charAt(0).toUpperCase()}</div>
                                <div class="user-info">
                                    <h4>${user.nickname}</h4>
                                    <p>ID: ${user.userId}</p>
                                    <p>房间: ${user.roomId}</p>
                                    <p>最后活动: ${lastActiveTime}</p>
                                </div>
                                <div class="online-indicator offline"></div>
                            </div>
                        `;
                    });
                }
                offlineUsersList.innerHTML = offlineHtml;
                
            } catch (error) {
                console.error('加载用户数据失败:', error);
                document.getElementById('onlineUsersList').innerHTML = '<p class="text-center">加载用户数据失败</p>';
                document.getElementById('offlineUsersList').innerHTML = '<p class="text-center">加载用户数据失败</p>';
            }
        }

        // 加载日志
        async function loadLogs() {
            try {
                const logsTableBody = document.getElementById('logsTableBody');
                logsTableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                <p>加载日志数据...</p>
                            </div>
                        </td>
                    </tr>
                `;
                
                // 这里模拟日志数据，实际应用中应该从服务器获取
                const mockLogs = [
                    { time: new Date().toLocaleString(), level: 'INFO', module: '房间服务', action: '创建房间', detail: '房间 test-room 创建成功' },
                    { time: new Date(Date.now() - 300000).toLocaleString(), level: 'INFO', module: '用户服务', action: '用户加入', detail: '用户 user123 加入房间 test-room' },
                    { time: new Date(Date.now() - 600000).toLocaleString(), level: 'WARN', module: '清理服务', action: '清理离线用户', detail: '清理了 2 个离线用户' },
                    { time: new Date(Date.now() - 900000).toLocaleString(), level: 'ERROR', module: 'API服务', action: '请求错误', detail: '/api/room/invalid 接口不存在' },
                    { time: new Date(Date.now() - 1200000).toLocaleString(), level: 'INFO', module: '系统', action: '服务器启动', detail: 'HTTPS服务器启动在端口 6000' }
                ];
                
                let rows = '';
                mockLogs.forEach(log => {
                    let levelClass = '';
                    if (log.level === 'ERROR') levelClass = 'status-inactive';
                    else if (log.level === 'WARN') levelClass = 'status-active';
                    
                    rows += `
                        <tr>
                            <td>${log.time}</td>
                            <td><span class="status-badge ${levelClass}">${log.level}</span></td>
                            <td>${log.module}</td>
                            <td>${log.action}</td>
                            <td>${log.detail}</td>
                        </tr>
                    `;
                });
                
                logsTableBody.innerHTML = rows;
            } catch (error) {
                console.error('加载日志失败:', error);
                document.getElementById('logsTableBody').innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center">加载日志数据失败</td>
                    </tr>
                `;
            }
        }

        // 保存系统配置
        function saveSystemConfig() {
            const port = document.getElementById('serverPort').value;
            const maxUsers = document.getElementById('maxUsersPerRoom').value;
            const userTimeout = document.getElementById('userOfflineTimeout').value;
            const roomTimeout = document.getElementById('roomIdleTimeout').value;
            const cleanupInterval = document.getElementById('cleanupInterval').value;
            
            // 这里应该调用API保存配置
            // 由于原API没有保存配置的接口，这里只是模拟
            
            showToast('系统配置已保存', 'success');
            
            // 在实际应用中，这里应该调用API更新配置
            console.log('保存系统配置:', {
                port, maxUsers, userTimeout, roomTimeout, cleanupInterval
            });
        }

        // 显示确认对话框
        function showConfirm(message, callback) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmAction').onclick = function() {
                confirmModal.style.display = 'none';
                if (callback) callback();
            };
            
            confirmModal.style.display = 'flex';
        }

        // 关闭模态框
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // 显示Toast通知
        function showToast(message, type = 'info') {
            // 移除已有的toast
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            // 创建toast元素
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div class="toast-content">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                    <span>${message}</span>
                </div>
                <button class="toast-close">&times;</button>
            `;
            
            // 添加到页面
            document.body.appendChild(toast);
            
            // 添加样式
            const style = document.createElement('style');
            style.textContent = `
                .toast {
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background-color: white;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                    padding: 15px 20px;
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    min-width: 300px;
                    max-width: 400px;
                    z-index: 9999;
                    animation: slideIn 0.3s ease-out;
                    border-left: 4px solid #3498db;
                }
                .toast-success { border-left-color: #27ae60; }
                .toast-error { border-left-color: #e74c3c; }
                .toast-info { border-left-color: #3498db; }
                .toast-content {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                }
                .toast-content i {
                    font-size: 1.2rem;
                }
                .toast-success .toast-content i { color: #27ae60; }
                .toast-error .toast-content i { color: #e74c3c; }
                .toast-info .toast-content i { color: #3498db; }
                .toast-close {
                    background: none;
                    border: none;
                    font-size: 1.5rem;
                    cursor: pointer;
                    color: #7f8c8d;
                    padding: 0;
                    line-height: 1;
                }
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            // 关闭按钮事件
            toast.querySelector('.toast-close').addEventListener('click', function() {
                toast.remove();
            });
            
            // 3秒后自动消失
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.style.animation = 'slideOut 0.3s ease-out';
                    setTimeout(() => {
                        if (toast.parentNode) toast.remove();
                    }, 300);
                    
                    // 添加消失动画
                    const slideOutStyle = document.createElement('style');
                    slideOutStyle.textContent = `
                        @keyframes slideOut {
                            from { transform: translateX(0); opacity: 1; }
                            to { transform: translateX(100%); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(slideOutStyle);
                }
            }, 3000);
        }
    </script>
</body>
</html>